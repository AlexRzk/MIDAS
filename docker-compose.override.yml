# Local development override: Use relative bind mounts (./data/...) rather than named volumes with driver_opts.
# This avoids Docker requiring the host folders to pre-exist when compose tries to create or mount the named volumes.

services:
  collector:
    volumes:
      - ./data/raw:/data/raw
  processor:
    volumes:
      - ./data/raw:/data/raw:ro
      - ./data/clean:/data/clean
  features:
    volumes:
      - ./data/clean:/data/clean:ro
      - ./data/features:/data/features

  # Tools service for local development: mount repo, run one-off commands
  tools:
    build:
      context: .
      dockerfile: Dockerfile.tools
    image: midas-tools:latest
    container_name: midas-tools-local
    volumes:
      - ./:/app
    working_dir: /app
    environment:
      - PYTHONUNBUFFERED=1
    entrypoint: ["/bin/bash", "-c"]
    command: ["sleep infinity"]

volumes:
  # Keep named volumes present to avoid brew-up differences in compose
  raw_data: {}
  clean_data: {}
  features_data: {}
